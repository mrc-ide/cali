[{"path":"/articles/Advanced_calibration.html","id":"population-size","dir":"Articles","previous_headings":"","what":"Population size","title":"Advanced_calibration","text":"single correct answer question “modelled population size use?”. pursuit efficiency calibration process, preference begin modestly sized modelled population. approach, however, requires balance: population must sufficiently large ensure level stochastic noise remains within acceptable bounds avoid unwanted elimination due stochastic fade-. unwanted elimination occurs (output = 0 taregt != 0), algoritm first increase human population size subsequent larger value specified human_population argument. must happy level stochastic run smallest values human_popualation argument. can see occuring :","code":"# Define target, here a prevalence measures: target <- 0.001 parameters <- get_parameters() parameters$timesteps <- 365 * 3 set.seed(123) out <- calibrate(   parameters = parameters,   target = target,   summary_function = summary_mean_pfpr_2_10,   eq_prevalence = target,   human_population = c(100, 1000, 10000) ) #> Initialising EIR #> Slice sampling EIR, side 1 #> Attempt 1 of 10 #>  #>  #>  Current   Target #> --------  ------- #>        0    0.001 #>  #>  #>  #>     EIR   Objective #> -------  ---------- #>  0.0055          NA #>  0.0000          NA #> Increasing human population due to elimination #> Running with new population size: 1000 #> Attempt 2 of 10 #>  #>  #>  Current   Target #> --------  ------- #>   0.0029    0.001 #>  #>  #>  #>     EIR   Objective #> -------  ---------- #>  0.0055      0.0019 #>  0.0000          NA #> Slice sampling EIR, side 2 #> Attempt 3 of 10 #>  #>  #>  Current   Target #> --------  ------- #>  5.8e-05    0.001 #>  #>  #>  #>     EIR   Objective #> -------  ---------- #>  0.0055     0.00190 #>  0.0034    -0.00094 #> Success"},{"path":"/articles/Advanced_calibration.html","id":"eir-initialisation","dir":"Articles","previous_headings":"","what":"EIR initialisation","title":"Advanced_calibration","text":"provide reasonable starting guess calibration, use malaria model equilibrium solution match baseline PfPr eq_prevalence given level treatment coverage eq_ft. good initialised EIR mean algorithm converges quickly, isn’t necessary. don’t know eq_prevalence eq_ft, try reasonable guess.","code":""},{"path":"/articles/Advanced_calibration.html","id":"weighting-target-values","dir":"Articles","previous_headings":"","what":"Weighting target values","title":"Advanced_calibration","text":"may situation evidence support specific target data . situation can weight target summary function bias fitting towards away certain points.","code":"target <- c(0.5, 0.2, 0.1) weights = c(0.1, 1, 1) weighted_target <- target * weights  weighted_annual_pfpr_summary <- function(x, w = weights){   year <- ceiling(x$timestep / 365)   pfpr <- x$n_detect_lm_730_3650  / x$n_age_730_3650   tapply(pfpr, year, mean) * w }  parameters <- get_parameters() |>   set_bednets(     timesteps = 365 * 0:2,     coverages = c(0, 0.3, 0.4),     retention = 5 * 365,     dn0 = matrix(0.53, nrow = 3, ncol = 1),     rn = matrix(0.56, nrow = 3, ncol = 1),     rnm = matrix(0.24, nrow = 3, ncol = 1),     gamman = rep(2.64 * 365, 3)   ) parameters$timesteps <- 365 * 3  set.seed(123) out <- calibrate(   parameters = parameters,   target = weighted_target,   summary_function = weighted_annual_pfpr_summary,   eq_prevalence = target[1] ) #> Initialising EIR #> Slice sampling EIR, side 1 #> Attempt 1 of 10 #>  #>  #>  Current   Target #> --------  ------- #>     0.05     0.05 #>     0.35     0.20 #>     0.18     0.10 #>  #>  #>  #>  EIR   Objective #> ----  ---------- #>   15        0.24 #>    0          NA #> Slice sampling EIR, side 2 #> Attempt 2 of 10 #>  #>  #>  Current   Target #> --------  ------- #>    0.037     0.05 #>    0.280     0.20 #>    0.120     0.10 #>  #>  #>  #>  EIR   Objective #> ----  ---------- #>   15        0.24 #>    9        0.09 #> Attempt 3 of 10 #>  #>  #>  Current   Target #> --------  ------- #>    0.033     0.05 #>    0.190     0.20 #>    0.090     0.10 #>  #>  #>  #>  EIR   Objective #> ----  ---------- #>  9.0       0.090 #>  5.5      -0.039 #> Success  parameters$human_population <- 5000 parameters <- set_equilibrium(parameters, init_EIR = out) raw <- run_simulation(parameters$timesteps + 100, parameters = parameters) raw$pfpr <- raw$n_detect_lm_730_3650  / raw$n_age_730_3650  ggplot() +   geom_point(aes(x = 365 * (0:2 + 0.5), y = target), col = \"dodgerblue\", size = 4) +    geom_line(data = raw, aes(x = timestep, y = pfpr), col = \"deeppink\", linewidth = 1) +   ylim(0, 1) +   ylab(expression(italic(Pf)*Pr[2-10])) +   xlab(\"Time\") +   theme_bw()"},{"path":"/articles/Basic_calibration.html","id":"calibrate-good-times-come-on","dir":"Articles","previous_headings":"","what":"Calibrate good times, come on!","title":"Basic calibration","text":"First, let’s define target trying match . instance, want match prevalence 2-10 year olds two time points: must supply summary function calibrating. function takes raw model output returns vector (length target), target variable. PfPr 2-10, example helper function summarises mean prevalence summary_mean_pfpr_2_10(). also need set aspects simulation. case, set basic model run: First, let’s run sense check summary function works! Looks good! summary produces prevalence summary format target. Now time calibration. set tolerance 0.005. means distance target value model output prevalence needs <0.5%. tolerance specified unit target variable. also cheat bit put tight bound EIR search help speed code. Ok, ’ve calibrated. Lets run calibrated model see .","code":"# Define target, here a prevalence measures: target <- 0.3 parameters <- get_parameters() parameters$timesteps <- 365 * 3 run_simulation(   timesteps = parameters$timesteps,   parameters = parameters ) |>   summary_mean_pfpr_2_10() #> [1] 0.6744576 set.seed(123) out <- calibrate(   parameters = parameters,   target = target,   summary_function = summary_mean_pfpr_2_10,   eq_prevalence = target,   human_population = c(10000, 100000) ) #> Initialising EIR #> Slice sampling EIR, side 1 #> Attempt 1 of 10 #>  #>  #>  Current   Target #> --------  ------- #>      0.3      0.3 #>  #>  #>  #>  EIR   Objective #> ----  ---------- #>  4.4      0.0039 #>  0.0          NA #> Slice sampling EIR, side 2 #> Attempt 2 of 10 #>  #>  #>  Current   Target #> --------  ------- #>     0.21      0.3 #>  #>  #>  #>  EIR   Objective #> ----  ---------- #>  4.4      0.0039 #>  2.7     -0.0870 #> Success parameters$human_population <- 5000 parameters <- set_equilibrium(parameters, init_EIR = out) raw <- run_simulation(parameters$timesteps + 100, parameters = parameters) pfpr <- raw$n_detect_lm_730_3650  / raw$n_age_730_3650  pd <- data.frame(time = 1:(parameters$timesteps + 100), pfpr = pfpr)  ggplot() +   geom_hline(yintercept = target, col = \"dodgerblue\", lty = 2) +    geom_line(data = pd, aes(x = time, y = pfpr), col = \"deeppink\", linewidth = 1) +   ylim(0, 1) +   theme_bw()"},{"path":"/articles/Basic_calibration.html","id":"tips-and-pointers","dir":"Articles","previous_headings":"","what":"Tips and pointers!","title":"Basic calibration","text":"Note, many situations possible calibrate tightly targets, especially multiple time points. just changing baseline EIR, trends targets time need captured aspects simulation set - example intervention coverage. Don’t expect able match data, ’ll never match trend increasing prevalence time model run increasing intervention coverage time !","code":""},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Pete Winskill. Author, maintainer.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Winskill P (2024). cali: Good vibes model calibration. R package version 1.0.8.","code":"@Manual{,   title = {cali: Good vibes and model calibration},   author = {Pete Winskill},   year = {2024},   note = {R package version 1.0.8}, }"},{"path":"/index.html","id":"cali-","dir":"","previous_headings":"","what":"Good vibes and model calibration","title":"Good vibes and model calibration","text":"Use cali calibrate individual model output specific target. Cali developed primarily malariasimulation use case.","code":""},{"path":"/reference/calibrate.html","id":null,"dir":"Reference","previous_headings":"","what":"Calibrate — calibrate","title":"Calibrate — calibrate","text":"General calibration function malariasimulation.","code":""},{"path":"/reference/calibrate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calibrate — calibrate","text":"","code":"calibrate(   parameters,   target,   summary_function,   eq_prevalence,   eq_ft = 0,   human_population = c(1000, 10000, 1e+05),   eir_limits = c(0, 1500),   max_attempts = 10 )"},{"path":"/reference/calibrate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calibrate — calibrate","text":"parameters Malariasimulation model parameter list target Values target variable calibrate . summary_function function take raw model output eq_prevalence Estimate baseline prevalence (inform EIR initialisation) eq_ft Estimate baseline treatment coverage (inform EIR initialisation) human_population Vector increasing population sizes. eir_limits Limits EIR max_attempts Maximum number calibration attempts (model runs)","code":""},{"path":"/reference/calibrate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calibrate — calibrate","text":"EIR estimate","code":""},{"path":"/reference/check_elimination.html","id":null,"dir":"Reference","previous_headings":"","what":"Elimination check — check_elimination","title":"Elimination check — check_elimination","text":"Elimination check","code":""},{"path":"/reference/check_elimination.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Elimination check — check_elimination","text":"","code":"check_elimination(output, target)"},{"path":"/reference/check_elimination.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Elimination check — check_elimination","text":"output Model run output target Target","code":""},{"path":"/reference/check_elimination.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Elimination check — check_elimination","text":"Boolean indicator unwanted elimination","code":""},{"path":"/reference/check_fit.html","id":null,"dir":"Reference","previous_headings":"","what":"Check the fit with proposed EIR — check_fit","title":"Check the fit with proposed EIR — check_fit","text":"Check fit proposed EIR","code":""},{"path":"/reference/check_fit.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check the fit with proposed EIR — check_fit","text":"","code":"check_fit(proposed_eir, parameters, target, summary_function)"},{"path":"/reference/check_fit.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check the fit with proposed EIR — check_fit","text":"proposed_eir Proposed new EIR value parameters Malariasimulation model parameter list target Values target variable calibrate . summary_function function take raw model output ","code":""},{"path":"/reference/check_fit.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check the fit with proposed EIR — check_fit","text":"Boolean indicator move success","code":""},{"path":"/reference/eq_objective.html","id":null,"dir":"Reference","previous_headings":"","what":"Equilibrium Objective function — eq_objective","title":"Equilibrium Objective function — eq_objective","text":"Used estimate starting EIR given PfPr","code":""},{"path":"/reference/eq_objective.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Equilibrium Objective function — eq_objective","text":"","code":"eq_objective(eir, target_pfpr, ft)"},{"path":"/reference/eq_objective.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Equilibrium Objective function — eq_objective","text":"eir EIR adults, units infectious bites per person per year target_pfpr Target PfPr 2-10 year olds ft proportion clinical cases effectively treated","code":""},{"path":"/reference/eq_objective.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Equilibrium Objective function — eq_objective","text":"difference current target prevalence","code":""},{"path":"/reference/from_real.html","id":null,"dir":"Reference","previous_headings":"","what":"Transform unbounded to bounded — from_real","title":"Transform unbounded to bounded — from_real","text":"Transform unbounded bounded","code":""},{"path":"/reference/from_real.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Transform unbounded to bounded — from_real","text":"","code":"from_real(x, limits)"},{"path":"/reference/from_real.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Transform unbounded to bounded — from_real","text":"x Value limits Vector lower upper limits","code":""},{"path":"/reference/from_real.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Transform unbounded to bounded — from_real","text":"Transformed value","code":""},{"path":"/reference/get_eq_eir.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimate the EIR for a target PfPr — get_eq_eir","title":"Estimate the EIR for a target PfPr — get_eq_eir","text":"Estimate equilibrium EIR results specified Plasmodium falciparum prevalence 2-10 year olds given treatment coverage","code":""},{"path":"/reference/get_eq_eir.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimate the EIR for a target PfPr — get_eq_eir","text":"","code":"get_eq_eir(target_pfpr, ft = 0.1)"},{"path":"/reference/get_eq_eir.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimate the EIR for a target PfPr — get_eq_eir","text":"target_pfpr Target PfPr 2-10 year olds ft proportion clinical cases effectively treated","code":""},{"path":"/reference/get_eq_eir.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimate the EIR for a target PfPr — get_eq_eir","text":"EIR","code":""},{"path":"/reference/get_eq_eir.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Estimate the EIR for a target PfPr — get_eq_eir","text":"","code":"get_eq_eir(target_pfpr = 0.2, ft = 0.4) #> [1] 3.759463"},{"path":"/reference/good_move.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if the move has been successful — good_move","title":"Check if the move has been successful — good_move","text":"Check move successful","code":""},{"path":"/reference/good_move.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if the move has been successful — good_move","text":"","code":"good_move(objective, direction)"},{"path":"/reference/good_move.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if the move has been successful — good_move","text":"objective Vector objectives direction Direction","code":""},{"path":"/reference/good_move.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if the move has been successful — good_move","text":"Boolean indicator move success","code":""},{"path":"/reference/linear_interpolate.html","id":null,"dir":"Reference","previous_headings":"","what":"Interpolate EIR linearly — linear_interpolate","title":"Interpolate EIR linearly — linear_interpolate","text":"Interpolate EIR linearly","code":""},{"path":"/reference/linear_interpolate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Interpolate EIR linearly — linear_interpolate","text":"","code":"linear_interpolate(eir, objective)"},{"path":"/reference/linear_interpolate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Interpolate EIR linearly — linear_interpolate","text":"eir Vector EIRs objective Vector objectives","code":""},{"path":"/reference/linear_interpolate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Interpolate EIR linearly — linear_interpolate","text":"Interpolated EIR","code":""},{"path":"/reference/pfpr_2_10.html","id":null,"dir":"Reference","previous_headings":"","what":"Equilibrium PfPr — pfpr_2_10","title":"Equilibrium PfPr — pfpr_2_10","text":"Estimate equilibrium pfpr prevalence given eir treatment coverage","code":""},{"path":"/reference/pfpr_2_10.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Equilibrium PfPr — pfpr_2_10","text":"","code":"pfpr_2_10(eir, ft = 0.1)"},{"path":"/reference/pfpr_2_10.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Equilibrium PfPr — pfpr_2_10","text":"eir EIR adults, units infectious bites per person per year ft proportion clinical cases effectively treated","code":""},{"path":"/reference/pfpr_2_10.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Equilibrium PfPr — pfpr_2_10","text":"Plamodium falciparum prevalence 2-10 year olds","code":""},{"path":"/reference/print_update.html","id":null,"dir":"Reference","previous_headings":"","what":"Update message — print_update","title":"Update message — print_update","text":"Update message","code":""},{"path":"/reference/print_update.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Update message — print_update","text":"","code":"print_update(eir, objective)"},{"path":"/reference/print_update.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Update message — print_update","text":"eir Vector EIRs objective Vector objectives","code":""},{"path":"/reference/proposal.html","id":null,"dir":"Reference","previous_headings":"","what":"Propose a new value for EIR — proposal","title":"Propose a new value for EIR — proposal","text":"Propose new value EIR","code":""},{"path":"/reference/proposal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Propose a new value for EIR — proposal","text":"","code":"proposal(current_eir, limits, direction, step = 0.5)"},{"path":"/reference/proposal.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Propose a new value for EIR — proposal","text":"current_eir Current value limits Inferred limits direction \"decrease\" \"increase\" step step size","code":""},{"path":"/reference/proposal.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Propose a new value for EIR — proposal","text":"New EIR value","code":""},{"path":"/reference/summary_mean_pfpr_2_10.html","id":null,"dir":"Reference","previous_headings":"","what":"Prevalence 2-10 year olds — summary_mean_pfpr_2_10","title":"Prevalence 2-10 year olds — summary_mean_pfpr_2_10","text":"Prevalence 2-10 year olds","code":""},{"path":"/reference/summary_mean_pfpr_2_10.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Prevalence 2-10 year olds — summary_mean_pfpr_2_10","text":"","code":"summary_mean_pfpr_2_10(x)"},{"path":"/reference/summary_mean_pfpr_2_10.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Prevalence 2-10 year olds — summary_mean_pfpr_2_10","text":"x malariasimualtion model output","code":""},{"path":"/reference/summary_mean_pfpr_2_10.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Prevalence 2-10 year olds — summary_mean_pfpr_2_10","text":"vector PfPR 2-10.","code":""},{"path":"/reference/to_real.html","id":null,"dir":"Reference","previous_headings":"","what":"Transform bounded to unbounded — to_real","title":"Transform bounded to unbounded — to_real","text":"Transform bounded unbounded","code":""},{"path":"/reference/to_real.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Transform bounded to unbounded — to_real","text":"","code":"to_real(x, limits)"},{"path":"/reference/to_real.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Transform bounded to unbounded — to_real","text":"x Value limits Vector lower upper limits","code":""},{"path":"/reference/to_real.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Transform bounded to unbounded — to_real","text":"Transformed value","code":""}]
